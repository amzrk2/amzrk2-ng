{{- $src := .Scratch.Get "scriptSrc" -}}
{{- $out := .Scratch.Get "scriptOut" -}}
{{- $options := (dict "targetPath" $out "minify" false "target" "esnext" "format" "iife") -}}

{{- $async := .Scratch.Get "scriptAsync" -}}

{{- if eq (getenv "NODE_ENV") "production" -}}

{{- if $async -}}
<script async src="{{ $out | relURL }}"></script>
{{- else -}}
<script defer src="{{ $out | relURL }}"></script>
{{- end -}}

{{- else -}}

<script>
  window.process = {
    env: { NODE_ENV: 'development' },
  };
</script>
{{- $built := resources.Get $src | js.Build $options -}}
{{- if $async -}}
<script async src="{{ $built.RelPermalink }}"></script>
{{- else -}}
<script defer src="{{ $built.RelPermalink }}"></script>
{{- end -}}

{{- end -}}

<!-- reset params -->
{{- .Scratch.Set "scriptSrc" nil -}}
{{- .Scratch.Set "scriptOut" nil -}}
{{- .Scratch.Set "scriptAsync" nil -}}
