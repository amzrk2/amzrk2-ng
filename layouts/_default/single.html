{{- define "head" -}}

<head>
  {{- partial "head.html" . -}}

  {{- .Scratch.Set "styleSrc" "styles/pages/single.scss" -}}
  {{- .Scratch.Set "styleOut" "assets/dsr-blog_single.min.css" -}}
  {{- partial "style.html" . -}}
</head>

{{- end -}}

{{- define "body" -}}

<body data-theme="auto" data-section="single">
  {{- partial "theme.html" . -}}
  {{- partial "header.html" . -}}

  <main class="main">
    <div class="container">
      <div class="content">
        <div class="content__inner post__article">
          <div class="card">
            {{- if .Params.image -}}
            <div class="post__image image image__ratio-40x9">
              <img class="lazyload" data-src="{{- .Params.image | relURL -}}" />
            </div>
            {{- end -}}
            <div class="post__title">
              <h2>{{- .Title -}}</h2>
            </div>
            {{- partial "metadata.html" . -}}
            <div class="post__content">
              <article class="markdown">
                {{ .Content }}
              </article>
            </div>
            {{- if ne .Params.license false -}}
            <div class="license markdown">
              <blockquote>{{- .Site.Params.license -}}</blockquote>
            </div>
            {{- end -}}
          </div>

          {{- if and (ne .Params.comment false) (ne .Section "code") -}}
          <div class="card comment">
            <div class="comment__loading" id="comment-loading">
              <svg class="icon spin" aria-hidden="true">
                <use xlink:href="#icon-spinner-third"></use>
              </svg>
              {{- printf "<span>评论区正在等待加载</span>" | safeHTML -}}
            </div>
            {{ $formated := replace .File.Path "\\" "/" }}
            {{ $path := split $formated "." }}
            <div class="comment__wrapper" id="comment" data-identifier="{{- index $path 0 -}}">
            </div>
          </div>
          {{- end -}}
        </div>
      </div>
      <aside class="sidebar">
        <div class="sidebar__inner">
          {{- partial "info.html" . -}}
          <div class="sticky">
            {{- if ne .Params.toc false -}}
            <div class="card toc markdown" id="content-toc">
              {{- .TableOfContents -}}
            </div>
            {{- end -}}
          </div>
        </div>
      </aside>
    </div>
  </main>

  {{- partial "footer.html" . -}}

  <script defer src='{{- $.Scratch.Get "DEP_lazysizes" -}}'></script>
  {{- .Scratch.Set "scriptSrc" "js/base.js" -}}
  {{- .Scratch.Set "scriptOut" "assets/dsr-blog_base.min.js" -}}
  {{- partial "script.html" . -}}
  {{- .Scratch.Set "scriptSrc" "js/single.js" -}}
  {{- .Scratch.Set "scriptOut" "assets/dsr-blog_single.min.js" -}}
  {{- partial "script.html" . -}}
  <script defer src='{{- $.Scratch.Get "DEP_prism-core" -}}'></script>
  <script defer src='{{- $.Scratch.Get "DEP_prism-autoloader" -}}'></script>
</body>

{{- end -}}
